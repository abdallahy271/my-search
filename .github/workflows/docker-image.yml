name: Docker Image CI

on:
  push:
    branches: [ "master" ]
    
defaults:
  run:
    working-directory: backend


jobs:

  build:

    runs-on: self-hosted

    steps:
    - uses: actions/checkout@v3
    - name: 'Create env file'
      run: |
          mkdir .env && touch .env/queue.env && touch .env/api.env
          echo "${GITHUB_WORKSPACE}"
          echo "${{ secrets.CELERY_BROKER_URL }}" > .env/queue.env
          echo "${{ secrets.API_ENV }}" > .env/api.env

    - name: 'Print PWD'
      run: |
        echo "${{ env.working-directory }}"
      
    - name: Build the Docker image
      run: |
        docker-compose up --build 
